import{_ as T,r as i,f as D,o as F,c as n,a as e,t as y,w as h,h as A,i as M,F as _,b,v as N,u as j,d as s,j as P}from"./index-BqAs3Nl1.js";const q={class:"category-manager"},z={key:0},G={class:"header-section"},H={class:"category-form"},Q={class:"category-list"},W=["onUpdate:modelValue","onBlur","onKeyup"],X=["onClick"],Y={class:"category-actions"},Z=["onClick"],x=["onClick"],ee=["onClick"],te={class:"batch-category"},oe=["value"],ae={class:"anime-categories"},le=["value"],ne=["onUpdate:modelValue","onChange"],se=["value"],ue={key:1},re={__name:"CategoryManager",setup(ie){const C=j(),E=D(),L=i(localStorage.getItem("userRole")||"user"),r=i(E.params.month||"2025.10"),u=i(JSON.parse(localStorage.getItem(`animeCategories${r.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),m=i(""),v=i([]),d=i(-1),f=i(""),g=i([]),p=i(""),$=()=>{m.value.trim()&&(u.value.push({name:m.value.trim()}),m.value="",k())},U=o=>{u.value.splice(o,1),k()},k=()=>{localStorage.setItem(`animeCategories${r.value}`,JSON.stringify(u.value))},S=o=>{d.value=o,f.value=u.value[o].name},I=o=>{u.value[o].name.trim()?(d.value=-1,k()):(u.value[o].name=f.value,d.value=-1)},B=o=>{u.value[o].name=f.value,d.value=-1},J=()=>{if(!p.value){alert("请先选择分类");return}g.value.forEach(o=>{const t=v.value.find(l=>l.id===o);t&&(t.category=p.value)}),localStorage.setItem(`animeList${r.value}`,JSON.stringify(v.value)),console.log(`批量分类完成，共更新 ${g.value.length} 部番剧`),g.value=[],p.value=""},O=()=>{r.value==="2026.1"?C.push({name:"Anime20261"}):C.push({name:"AnimeList"})},R=()=>{C.push({name:"Restricted"})},w=()=>{C.push({name:"MonthEditor",params:{month:r.value}})},K=o=>{try{localStorage.setItem(`animeList${r.value}`,JSON.stringify(v.value)),console.log(`更新番剧 ${o.title} 的分类为 ${o.category}`)}catch(t){console.error("保存番剧分类失败:",t),alert("保存分类失败，请检查浏览器存储设置")}},V=()=>{try{k(),localStorage.setItem(`animeList${r.value}`,JSON.stringify(v.value)),alert("所有更改已保存"),console.log("所有分类更改已保存")}catch(o){console.error("保存所有更改失败:",o),alert("保存失败，请检查浏览器存储设置")}};return F(()=>{try{const o=JSON.parse(localStorage.getItem(`animeList${r.value}`));o?v.value=o:v.value=[]}catch(o){console.error("加载番剧分类失败:",o),alert("加载分类失败，请检查浏览器存储设置")}}),(o,t)=>(s(),n("div",q,[L.value==="admin"?(s(),n("div",z,[e("div",G,[e("h1",null,y(r.value.value)+" 分类管理",1),e("div",{class:"nav-buttons"},[e("button",{class:"nav-btn",onClick:O},"主页面"),e("button",{class:"nav-btn",onClick:w},"动漫编辑"),e("button",{class:"nav-btn save-btn",onClick:V},"保存所有更改")])]),e("div",H,[t[3]||(t[3]=e("h2",null,"添加新分类",-1)),h(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),placeholder:"输入分类名称",onKeyup:M($,["enter"])},null,544),[[A,m.value]]),e("button",{onClick:$},"添加")]),e("div",Q,[t[4]||(t[4]=e("h2",null,"现有分类",-1)),(s(!0),n(_,null,b(u.value,(l,a)=>(s(),n("div",{key:a,class:"category-item"},[d.value===a?h((s(),n("input",{key:0,type:"text","onUpdate:modelValue":c=>u.value[a].name=c,onBlur:c=>I(a),onKeyup:M(c=>I(a),["enter"]),class:"edit-input"},null,40,W)),[[A,u.value[a].name]]):(s(),n("span",{key:1,onClick:c=>S(a)},y(l.name),9,X)),e("div",Y,[d.value===a?(s(),n("button",{key:0,onClick:c=>B(a)},"取消",8,Z)):(s(),n("button",{key:1,onClick:c=>S(a)},"编辑",8,x)),e("button",{onClick:c=>U(a)},"删除",8,ee)])]))),128))]),e("div",te,[t[6]||(t[6]=e("h2",null,"批量分类",-1)),h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>p.value=l)},[t[5]||(t[5]=e("option",{value:""},"选择分类",-1)),(s(!0),n(_,null,b(u.value,l=>(s(),n("option",{key:l.name,value:l.name},y(l.name),9,oe))),128))],512),[[N,p.value]]),e("button",{onClick:J},"应用到选中番剧")]),e("div",ae,[t[8]||(t[8]=e("h2",null,"番剧分类",-1)),(s(!0),n(_,null,b(v.value,l=>(s(),n("div",{key:l.id,class:"anime-category-item"},[h(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>g.value=a),value:l.id},null,8,le),[[P,g.value]]),e("span",null,y(l.title),1),h(e("select",{"onUpdate:modelValue":a=>l.category=a,onChange:a=>K(l)},[t[7]||(t[7]=e("option",{value:""},"未分类",-1)),(s(!0),n(_,null,b(u.value,a=>(s(),n("option",{key:a.name,value:a.name},y(a.name),9,se))),128))],40,ne),[[N,l.category]])]))),128))]),e("div",{class:"save-section"},[e("button",{class:"save-btn",onClick:V},"保存所有更改")])])):(s(),n("div",ue,[e("div",{class:"restricted-access"},[t[9]||(t[9]=e("h1",null,"权限不足",-1)),t[10]||(t[10]=e("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),e("button",{class:"nav-btn",onClick:R},"返回")])]))]))}},ce=T(re,[["__scopeId","data-v-2dcff659"]]);export{ce as default};
